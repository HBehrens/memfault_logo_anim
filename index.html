<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
  <style>
    svg {
      border: 1px solid black;
      background: pink;
      display: block;
      position: relative;
      margin: auto;
      top: 50%;
      transform: translateY(-50%);
    }
  </style>
</head>
<body>
  <script>
    window.onload = function () {
      const ease = "power2.inOut";
      // const ease = "elastic.inOut";
      const angle = "270deg";
      const duration = 4;
      const repeat = -1;
      const repeatDelay = duration / 2;
    //   gsap.to("svg", {
    //     "--level1_rot": angle,
    //     duration,
    //     ease,
    //     repeat,
    //     repeatDelay,
    //   });
    //   gsap.to("svg", {
    //     "--level2_rot": angle,
    //     delay: 0.3,
    //     duration,
    //     ease,
    //     repeat,
    //     repeatDelay,
    //   });
    //   gsap.to("svg", {
    //     "--level3_rot": angle,
    //     delay: 0.6,
    //     duration,
    //     ease,
    //     repeat,
    //     repeatDelay,
    //   });

      gsap.to("svg", {
        "--stack_ofs_y": -10,
        ease: 'power1.inOut',
        yoyo: true,
        duration: 4,
        repeat: -1,
      });
      gsap.to("#shadow", {
        "opacity": 0.8,
        ease: 'power1.inOut',
        yoyo: true,
        duration: 4,
        repeat: -1,
      });

      const svg = document.getElementsByTagName("svg")[0];
      window.onmousemove = function (e) {
          const rect = svg.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          const deltaX = e.pageX - centerX;
          const deltaY = e.pageY - centerY;
          // factors will be -1..+1
          const factorX = 2 * deltaX / window.innerWidth;
          const factorY = 2 * deltaY / window.innerHeight;

          // rotation of entire object
          svg.style.setProperty('--base_rot', `${(45 - factorX*40)}deg`);

          // "perspective" scaling
          const y_scale = gsap.utils.mapRange(-1, +1, 0.28, 0.80, factorY);
          svg.style.setProperty('--y_scale', `${y_scale}`);
          const level_dist = gsap.utils.mapRange(-1, +1, 52, 12, factorY);
          svg.style.setProperty('--level_dist', `${level_dist}px`);
          
      };
    };
  </script>
  <svg width="200" height="200">
    <style>
        :root {
          --level1_rot: 0deg;
          --level2_rot: 0deg;
          --level3_rot: 0deg;

          --base_ofs_x: 100px;
          --base_ofs_y: 50px;

          --y_scale: 0.38;
          --level_dist: 50px;

          --y_scale: 0.58;
          --level_dist: 32px;
          --base_rot: 45deg;
          --stack_ofs_y: 0px;
        }
        .col_dark {
          fill: #39c0ce;
        }
        .col_medium {
          fill: #b0e6eb;
        }
        .col_light {
          fill: #fff;
        }
        .level1 {
          transform: translate(0,0) rotate(calc(var(--level1_rot) + var(--base_rot)));
        }
        .level2 {
          transform: translate(0,var(--level_dist)) rotate(calc(var(--level2_rot) + var(--base_rot)));
        }
        .level3 {
          transform: translate(0,calc(2*var(--level_dist))) rotate(calc(var(--level3_rot) + var(--base_rot)));
        }
        #shadow {
            transform: translate(var(--base_ofs_x), var(--base_ofs_y));
        }

        #outer_group {
            transform: translate(var(--base_ofs_x), calc(var(--stack_ofs_y) + var(--base_ofs_y))) scale(1, var(--y_scale));
        }

        <!-- to avoid repitition, SVG <use> cannot be used -->
        rect {
          width: 100px;
          height: 100px;
          x: -50px;
          y: -50px;
          <!-- rx not recognized by Safari, so repeated below -->
      }
    </style>

    <defs>
      <clipPath class="level1" id="upper_clip">
        <rect rx="12" />
      </clipPath>
      <clipPath id="lower_clip" class="level2">
        <!-- inverted rounded rectangle since SVG does not support inverted clipping -->
        <path
          id="inverted_clip_rect"
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M150 -150H-150V150H150V-150ZM-38 -50C-44.6274 -50 -50 -44.6274 -50 -38V38C-50 44.6274 -44.6274 50 -38 50H38C44.6274 50 50 44.6274 50 38V-38C50 -44.6274 44.6274 -50 38 -50H-38Z"
          fill="#4807FF"
        />
      </clipPath>
      <radialGradient
        id="gradient_shadow"
        cx="50%"
        cy="50%"
        r="50%"
        gradientUnits="objectBoundingBox"
      >
        <stop stop-opacity="0.32" />
        <stop offset="1" stop-opacity="0" />
      </radialGradient>
    </defs>

    <ellipse
      id="shadow"
      cx="0"
      cy="75"
      rx="90"
      ry="30"
      fill="url(#gradient_shadow)"
      style="mix-blend-mode: darken"
    />

    <g id="outer_group">
      <g clip-path="url(#lower_clip)">
        <g class="level3">
          <rect class="col_dark" rx="12" />
        </g>
      </g>
      <g class="level1">
        <rect class="col_dark" rx="12" />
      </g>
      <g clip-path="url(#upper_clip)">
        <g class="level2">
          <rect class="col_medium" rx="12" />
        </g>
      </g>
      <g clip-path="url(#upper_clip)">
        <g class="level3">
          <rect class="col_light" rx="12" />
        </g>
      </g>
    </g>
  </svg>
</body>
